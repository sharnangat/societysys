-- --------------------------------------------------------
-- Host:                         127.0.0.1
-- Server version:               PostgreSQL 17.4 on x86_64-windows, compiled by msvc-19.43.34808, 64-bit
-- Server OS:                    
-- HeidiSQL Version:             12.10.0.7000
-- --------------------------------------------------------

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET NAMES  */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

-- Dumping structure for function society.calculate_pending_amount
DELIMITER //
CREATE FUNCTION "calculate_pending_amount"() RETURNS UNKNOWN AS $$ 
BEGIN
    NEW.pending_amount = NEW.total_amount - NEW.paid_amount + NEW.late_fee_amount;
    RETURN NEW;
END;
 $$//
DELIMITER ;

-- Dumping structure for function society.update_updated_at_column
DELIMITER //
CREATE FUNCTION "update_updated_at_column"() RETURNS UNKNOWN AS $$ 
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
 $$//
DELIMITER ;

-- Dumping structure for view society.active_member_units
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "active_member_units" (
	"society_name" VARCHAR(1) NULL,
	"username" VARCHAR(1) NULL,
	"member_name" TEXT NULL,
	"member_type" UNKNOWN NULL,
	"unit_number" VARCHAR(1) NULL,
	"unit_type" UNKNOWN NULL,
	"relationship" VARCHAR(1) NULL,
	"ownership_percentage" NUMERIC(5,2) NULL,
	"role_name" UNKNOWN NULL,
	"role_display_name" VARCHAR(1) NULL
) ENGINE=MyISAM;

-- Dumping structure for table society.assets
CREATE TABLE IF NOT EXISTS "assets" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"asset_code" VARCHAR(50) NOT NULL,
	"name" VARCHAR(255) NOT NULL,
	"description" TEXT NULL DEFAULT NULL,
	"category" VARCHAR(100) NULL DEFAULT NULL,
	"location" VARCHAR(255) NULL DEFAULT NULL,
	"purchase_date" DATE NULL DEFAULT NULL,
	"purchase_cost" NUMERIC(15,2) NULL DEFAULT NULL,
	"vendor" VARCHAR(255) NULL DEFAULT NULL,
	"warranty_period" INTEGER NULL DEFAULT NULL,
	"warranty_expiry" DATE NULL DEFAULT NULL,
	"depreciation_rate" NUMERIC(5,2) NULL DEFAULT NULL,
	"current_value" NUMERIC(15,2) NULL DEFAULT NULL,
	"last_maintenance_date" DATE NULL DEFAULT NULL,
	"next_maintenance_date" DATE NULL DEFAULT NULL,
	"maintenance_frequency" INTEGER NULL DEFAULT NULL,
	"condition" VARCHAR(50) NULL DEFAULT 'good',
	"is_active" BOOLEAN NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("asset_code"),
	CONSTRAINT "assets_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.audit_log
CREATE TABLE IF NOT EXISTS "audit_log" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"table_name" VARCHAR(100) NOT NULL,
	"record_id" UUID NOT NULL,
	"action" VARCHAR(20) NOT NULL,
	"old_values" JSONB NULL DEFAULT NULL,
	"new_values" JSONB NULL DEFAULT NULL,
	"changed_by" UUID NULL DEFAULT NULL,
	"changed_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	CONSTRAINT "audit_log_changed_by_fkey" FOREIGN KEY ("changed_by") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "audit_log_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.bills
CREATE TABLE IF NOT EXISTS "bills" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"unit_id" UUID NOT NULL,
	"bill_number" VARCHAR(100) NOT NULL,
	"bill_date" DATE NOT NULL DEFAULT CURRENT_DATE,
	"due_date" DATE NOT NULL,
	"period_from" DATE NOT NULL,
	"period_to" DATE NOT NULL,
	"total_amount" NUMERIC(15,2) NOT NULL DEFAULT 0,
	"paid_amount" NUMERIC(15,2) NOT NULL DEFAULT 0,
	"pending_amount" NUMERIC(15,2) NOT NULL DEFAULT 0,
	"late_fee_rate" NUMERIC(5,2) NULL DEFAULT 0,
	"late_fee_amount" NUMERIC(10,2) NULL DEFAULT 0,
	"status" UNKNOWN NULL DEFAULT 'pending',
	"notes" TEXT NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("bill_number"),
	KEY ("society_id"),
	KEY ("unit_id"),
	KEY ("due_date"),
	KEY ("status"),
	CONSTRAINT "bills_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "bills_unit_id_fkey" FOREIGN KEY ("unit_id") REFERENCES "units" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.bill_items
CREATE TABLE IF NOT EXISTS "bill_items" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"bill_id" UUID NOT NULL,
	"fee_head_id" UUID NOT NULL,
	"description" VARCHAR(255) NOT NULL,
	"quantity" NUMERIC(10,2) NULL DEFAULT 1,
	"rate" NUMERIC(10,2) NOT NULL,
	"amount" NUMERIC(15,2) NOT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	CONSTRAINT "bill_items_bill_id_fkey" FOREIGN KEY ("bill_id") REFERENCES "bills" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "bill_items_fee_head_id_fkey" FOREIGN KEY ("fee_head_id") REFERENCES "fee_heads" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for table society.company_config
CREATE TABLE IF NOT EXISTS "company_config" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"company_name" VARCHAR(255) NOT NULL DEFAULT 'Society Management Solutions',
	"company_email" VARCHAR(255) NOT NULL,
	"company_phone" VARCHAR(15) NOT NULL,
	"company_address" TEXT NULL DEFAULT NULL,
	"default_rate_per_member" NUMERIC(10,2) NULL DEFAULT 20.00,
	"currency" VARCHAR(10) NULL DEFAULT 'INR',
	"trial_period_days" INTEGER NULL DEFAULT 30,
	"max_free_members" INTEGER NULL DEFAULT 10,
	"support_email" VARCHAR(255) NULL DEFAULT NULL,
	"support_phone" VARCHAR(15) NULL DEFAULT NULL,
	"sales_email" VARCHAR(255) NULL DEFAULT NULL,
	"sales_phone" VARCHAR(15) NULL DEFAULT NULL,
	"payment_gateway_key" VARCHAR(500) NULL DEFAULT NULL,
	"whatsapp_api_key" VARCHAR(500) NULL DEFAULT NULL,
	"email_api_key" VARCHAR(500) NULL DEFAULT NULL,
	"is_active" BOOLEAN NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	KEY ("is_active")
);

-- Data exporting was unselected.

-- Dumping structure for table society.company_payments
CREATE TABLE IF NOT EXISTS "company_payments" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"subscription_id" UUID NOT NULL,
	"payment_reference" VARCHAR(100) NOT NULL,
	"payment_method" UNKNOWN NOT NULL,
	"amount" NUMERIC(15,2) NOT NULL,
	"billing_period_start" DATE NOT NULL,
	"billing_period_end" DATE NOT NULL,
	"member_count" INTEGER NOT NULL,
	"status" UNKNOWN NULL DEFAULT 'pending',
	"payment_date" DATE NULL DEFAULT NULL,
	"processed_by" VARCHAR(255) NULL DEFAULT NULL,
	"transaction_id" VARCHAR(255) NULL DEFAULT NULL,
	"gateway_response" JSONB NULL DEFAULT NULL,
	"receipt_number" VARCHAR(100) NULL DEFAULT NULL,
	"received_by" VARCHAR(255) NULL DEFAULT NULL,
	"notes" TEXT NULL DEFAULT NULL,
	"due_date" DATE NOT NULL,
	"paid_at" TIMESTAMPTZ NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("payment_reference"),
	KEY ("society_id"),
	KEY ("subscription_id"),
	KEY ("status"),
	KEY ("due_date"),
	CONSTRAINT "company_payments_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "company_payments_subscription_id_fkey" FOREIGN KEY ("subscription_id") REFERENCES "society_subscriptions" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for view society.company_payment_tracking
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "company_payment_tracking" (
	"society_name" VARCHAR(1) NULL,
	"payment_reference" VARCHAR(1) NULL,
	"amount" NUMERIC(15,2) NULL,
	"member_count" INTEGER NULL,
	"payment_method" UNKNOWN NULL,
	"status" UNKNOWN NULL,
	"billing_period_start" DATE NULL,
	"billing_period_end" DATE NULL,
	"due_date" DATE NULL,
	"payment_date" DATE NULL,
	"processed_by" VARCHAR(1) NULL,
	"transaction_id" VARCHAR(1) NULL,
	"payment_status" TEXT NULL
) ENGINE=MyISAM;

-- Dumping structure for table society.company_staff
CREATE TABLE IF NOT EXISTS "company_staff" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"employee_id" VARCHAR(50) NOT NULL,
	"first_name" VARCHAR(100) NOT NULL,
	"last_name" VARCHAR(100) NOT NULL,
	"email" VARCHAR(255) NOT NULL,
	"phone" VARCHAR(15) NOT NULL,
	"role" VARCHAR(100) NOT NULL,
	"department" VARCHAR(100) NULL DEFAULT NULL,
	"username" VARCHAR(50) NOT NULL,
	"password_hash" VARCHAR(255) NOT NULL,
	"can_process_payments" BOOLEAN NULL DEFAULT false,
	"can_activate_societies" BOOLEAN NULL DEFAULT false,
	"can_modify_pricing" BOOLEAN NULL DEFAULT false,
	"can_generate_reports" BOOLEAN NULL DEFAULT false,
	"is_active" BOOLEAN NULL DEFAULT true,
	"last_login" TIMESTAMPTZ NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("employee_id"),
	UNIQUE ("email"),
	UNIQUE ("username"),
	KEY ("username"),
	KEY ("email")
);

-- Data exporting was unselected.

-- Dumping structure for table society.complaints
CREATE TABLE IF NOT EXISTS "complaints" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"unit_id" UUID NULL DEFAULT NULL,
	"complainant_id" UUID NULL DEFAULT NULL,
	"complaint_number" VARCHAR(100) NOT NULL,
	"title" VARCHAR(255) NOT NULL,
	"description" TEXT NOT NULL,
	"category" VARCHAR(100) NULL DEFAULT NULL,
	"priority" UNKNOWN NULL DEFAULT 'medium',
	"status" UNKNOWN NULL DEFAULT 'open',
	"assigned_to" UUID NULL DEFAULT NULL,
	"assigned_date" TIMESTAMPTZ NULL DEFAULT NULL,
	"resolution" TEXT NULL DEFAULT NULL,
	"resolved_date" TIMESTAMPTZ NULL DEFAULT NULL,
	"resolved_by" UUID NULL DEFAULT NULL,
	"feedback" TEXT NULL DEFAULT NULL,
	"rating" INTEGER NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("complaint_number"),
	KEY ("society_id"),
	KEY ("status"),
	CONSTRAINT "complaints_assigned_to_fkey" FOREIGN KEY ("assigned_to") REFERENCES "staff" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "complaints_complainant_id_fkey" FOREIGN KEY ("complainant_id") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "complaints_resolved_by_fkey" FOREIGN KEY ("resolved_by") REFERENCES "staff" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "complaints_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "complaints_unit_id_fkey" FOREIGN KEY ("unit_id") REFERENCES "units" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "complaints_rating_check" CHECK (((rating >= 1) AND (rating <= 5)))
);

-- Data exporting was unselected.

-- Dumping structure for table society.credential_sharing_log
CREATE TABLE IF NOT EXISTS "credential_sharing_log" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"user_id" UUID NOT NULL,
	"sharing_method" VARCHAR(20) NOT NULL,
	"recipient_email" VARCHAR(255) NULL DEFAULT NULL,
	"recipient_phone" VARCHAR(15) NULL DEFAULT NULL,
	"subject" VARCHAR(255) NULL DEFAULT NULL,
	"message_content" TEXT NULL DEFAULT NULL,
	"delivery_status" VARCHAR(20) NULL DEFAULT 'pending',
	"sent_at" TIMESTAMPTZ NULL DEFAULT NULL,
	"delivered_at" TIMESTAMPTZ NULL DEFAULT NULL,
	"processed_by" UUID NULL DEFAULT NULL,
	"failure_reason" TEXT NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	KEY ("society_id"),
	KEY ("delivery_status"),
	CONSTRAINT "credential_sharing_log_processed_by_fkey" FOREIGN KEY ("processed_by") REFERENCES "company_staff" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "credential_sharing_log_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "credential_sharing_log_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for view society.current_visitors
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "current_visitors" (
	"id" UUID NULL,
	"society_name" VARCHAR(1) NULL,
	"unit_number" VARCHAR(1) NULL,
	"visitor_name" VARCHAR(1) NULL,
	"visitor_phone" VARCHAR(1) NULL,
	"visitor_type" UNKNOWN NULL,
	"purpose_of_visit" TEXT NULL,
	"check_in_time" TIMESTAMPTZ NULL,
	"minutes_inside" NUMERIC NULL,
	"vehicle_number" VARCHAR(1) NULL,
	"entry_gate" VARCHAR(1) NULL,
	"security_guard" TEXT NULL,
	"status" UNKNOWN NULL
) ENGINE=MyISAM;

-- Dumping structure for table society.documents
CREATE TABLE IF NOT EXISTS "documents" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"title" VARCHAR(255) NOT NULL,
	"description" TEXT NULL DEFAULT NULL,
	"document_type" UNKNOWN NOT NULL,
	"category" VARCHAR(100) NULL DEFAULT NULL,
	"file_name" VARCHAR(255) NOT NULL,
	"file_path" VARCHAR(500) NOT NULL,
	"file_size" BIGINT NULL DEFAULT NULL,
	"mime_type" VARCHAR(100) NULL DEFAULT NULL,
	"version" VARCHAR(20) NULL DEFAULT '1.0',
	"is_current_version" BOOLEAN NULL DEFAULT true,
	"is_public" BOOLEAN NULL DEFAULT false,
	"requires_approval" BOOLEAN NULL DEFAULT false,
	"tags" UNKNOWN NULL DEFAULT NULL,
	"uploaded_by" UUID NULL DEFAULT NULL,
	"approved_by" UUID NULL DEFAULT NULL,
	"approved_date" TIMESTAMPTZ NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	CONSTRAINT "documents_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "documents_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "documents_uploaded_by_fkey" FOREIGN KEY ("uploaded_by") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for table society.events
CREATE TABLE IF NOT EXISTS "events" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"title" VARCHAR(255) NOT NULL,
	"description" TEXT NULL DEFAULT NULL,
	"event_type" VARCHAR(100) NULL DEFAULT NULL,
	"start_date" DATE NOT NULL,
	"end_date" DATE NULL DEFAULT NULL,
	"start_time" TIME NULL DEFAULT NULL,
	"end_time" TIME NULL DEFAULT NULL,
	"venue" VARCHAR(255) NULL DEFAULT NULL,
	"is_mandatory" BOOLEAN NULL DEFAULT false,
	"max_participants" INTEGER NULL DEFAULT NULL,
	"registration_required" BOOLEAN NULL DEFAULT false,
	"registration_deadline" DATE NULL DEFAULT NULL,
	"send_notification" BOOLEAN NULL DEFAULT true,
	"notification_sent_at" TIMESTAMPTZ NULL DEFAULT NULL,
	"is_active" BOOLEAN NULL DEFAULT true,
	"created_by" UUID NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	KEY ("society_id"),
	CONSTRAINT "events_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "events_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.event_participants
CREATE TABLE IF NOT EXISTS "event_participants" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"event_id" UUID NOT NULL,
	"member_id" UUID NOT NULL,
	"registration_date" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"attendance_status" VARCHAR(50) NULL DEFAULT 'registered',
	PRIMARY KEY ("id"),
	UNIQUE ("event_id", "member_id"),
	CONSTRAINT "event_participants_event_id_fkey" FOREIGN KEY ("event_id") REFERENCES "events" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "event_participants_member_id_fkey" FOREIGN KEY ("member_id") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.family_members
CREATE TABLE IF NOT EXISTS "family_members" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"primary_member_id" UUID NOT NULL,
	"first_name" VARCHAR(100) NOT NULL,
	"middle_name" VARCHAR(100) NULL DEFAULT NULL,
	"last_name" VARCHAR(100) NOT NULL,
	"date_of_birth" DATE NULL DEFAULT NULL,
	"gender" VARCHAR(10) NULL DEFAULT NULL,
	"relationship" VARCHAR(50) NOT NULL,
	"phone" VARCHAR(15) NULL DEFAULT NULL,
	"email" VARCHAR(255) NULL DEFAULT NULL,
	"aadhar_number" VARCHAR(12) NULL DEFAULT NULL,
	"is_resident" BOOLEAN NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	CONSTRAINT "family_members_primary_member_id_fkey" FOREIGN KEY ("primary_member_id") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.fee_heads
CREATE TABLE IF NOT EXISTS "fee_heads" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"name" VARCHAR(255) NOT NULL,
	"description" TEXT NULL DEFAULT NULL,
	"is_recurring" BOOLEAN NULL DEFAULT true,
	"frequency" VARCHAR(50) NULL DEFAULT 'monthly',
	"rate_per_sqft" NUMERIC(10,2) NULL DEFAULT NULL,
	"flat_rate" NUMERIC(10,2) NULL DEFAULT NULL,
	"calculation_method" VARCHAR(50) NULL DEFAULT 'per_sqft',
	"applicable_to" UNKNOWN NULL DEFAULT ARRAY['flat'::unit_type],
	"is_active" BOOLEAN NULL DEFAULT true,
	"effective_from" DATE NOT NULL DEFAULT CURRENT_DATE,
	"effective_till" DATE NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	CONSTRAINT "fee_heads_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.gates
CREATE TABLE IF NOT EXISTS "gates" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"gate_name" VARCHAR(100) NOT NULL,
	"gate_code" VARCHAR(20) NOT NULL,
	"description" TEXT NULL DEFAULT NULL,
	"location" VARCHAR(255) NULL DEFAULT NULL,
	"is_main_gate" BOOLEAN NULL DEFAULT false,
	"is_pedestrian_only" BOOLEAN NULL DEFAULT false,
	"is_vehicle_allowed" BOOLEAN NULL DEFAULT true,
	"is_two_wheeler_allowed" BOOLEAN NULL DEFAULT true,
	"opening_time" TIME NULL DEFAULT NULL,
	"closing_time" TIME NULL DEFAULT NULL,
	"is_24x7" BOOLEAN NULL DEFAULT true,
	"status" UNKNOWN NULL DEFAULT 'open',
	"is_active" BOOLEAN NULL DEFAULT true,
	"has_camera" BOOLEAN NULL DEFAULT false,
	"has_intercom" BOOLEAN NULL DEFAULT false,
	"has_biometric" BOOLEAN NULL DEFAULT false,
	"has_qr_scanner" BOOLEAN NULL DEFAULT false,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("gate_code"),
	KEY ("society_id"),
	KEY ("status"),
	CONSTRAINT "gates_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.gate_activity_logs
CREATE TABLE IF NOT EXISTS "gate_activity_logs" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"gate_id" UUID NOT NULL,
	"visitor_log_id" UUID NULL DEFAULT NULL,
	"activity_type" VARCHAR(50) NOT NULL,
	"person_type" VARCHAR(20) NOT NULL,
	"person_identifier" VARCHAR(255) NULL DEFAULT NULL,
	"detection_method" VARCHAR(50) NULL DEFAULT NULL,
	"device_id" VARCHAR(100) NULL DEFAULT NULL,
	"camera_snapshot_url" VARCHAR(500) NULL DEFAULT NULL,
	"security_notes" TEXT NULL DEFAULT NULL,
	"alert_triggered" BOOLEAN NULL DEFAULT false,
	"alert_reason" TEXT NULL DEFAULT NULL,
	"activity_timestamp" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	KEY ("society_id"),
	KEY ("activity_timestamp"),
	CONSTRAINT "gate_activity_logs_gate_id_fkey" FOREIGN KEY ("gate_id") REFERENCES "gates" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "gate_activity_logs_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "gate_activity_logs_visitor_log_id_fkey" FOREIGN KEY ("visitor_log_id") REFERENCES "visitor_logs" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for view society.gate_activity_summary
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "gate_activity_summary" (
	"society_name" VARCHAR(1) NULL,
	"gate_name" VARCHAR(1) NULL,
	"activity_date" DATE NULL,
	"total_entries" BIGINT NULL,
	"total_exits" BIGINT NULL,
	"denied_attempts" BIGINT NULL,
	"security_alerts" BIGINT NULL
) ENGINE=MyISAM;

-- Dumping structure for table society.invitations
CREATE TABLE IF NOT EXISTS "invitations" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"invited_by" UUID NOT NULL,
	"email" VARCHAR(255) NOT NULL,
	"phone" VARCHAR(15) NULL DEFAULT NULL,
	"first_name" VARCHAR(100) NULL DEFAULT NULL,
	"last_name" VARCHAR(100) NULL DEFAULT NULL,
	"invitation_token" VARCHAR(255) NOT NULL,
	"role_id" UUID NOT NULL,
	"unit_id" UUID NULL DEFAULT NULL,
	"subject" VARCHAR(255) NULL DEFAULT NULL,
	"message" TEXT NULL DEFAULT NULL,
	"status" UNKNOWN NULL DEFAULT 'pending',
	"expires_at" TIMESTAMPTZ NOT NULL DEFAULT (CURRENT_TIMESTAMP + '7 days'::interval),
	"sent_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"accepted_at" TIMESTAMPTZ NULL DEFAULT NULL,
	"declined_at" TIMESTAMPTZ NULL DEFAULT NULL,
	"accepted_by" UUID NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("invitation_token"),
	KEY ("invitation_token"),
	KEY ("email"),
	KEY ("status"),
	CONSTRAINT "invitations_accepted_by_fkey" FOREIGN KEY ("accepted_by") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "invitations_invited_by_fkey" FOREIGN KEY ("invited_by") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "invitations_role_id_fkey" FOREIGN KEY ("role_id") REFERENCES "roles" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "invitations_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "invitations_unit_id_fkey" FOREIGN KEY ("unit_id") REFERENCES "units" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for table society.meetings
CREATE TABLE IF NOT EXISTS "meetings" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"meeting_type" VARCHAR(100) NOT NULL,
	"title" VARCHAR(255) NOT NULL,
	"agenda" TEXT NULL DEFAULT NULL,
	"meeting_date" DATE NOT NULL,
	"start_time" TIME NULL DEFAULT NULL,
	"end_time" TIME NULL DEFAULT NULL,
	"venue" VARCHAR(255) NULL DEFAULT NULL,
	"total_members" INTEGER NULL DEFAULT NULL,
	"members_present" INTEGER NULL DEFAULT NULL,
	"quorum_achieved" BOOLEAN NULL DEFAULT false,
	"minutes" TEXT NULL DEFAULT NULL,
	"resolutions" TEXT NULL DEFAULT NULL,
	"action_items" TEXT NULL DEFAULT NULL,
	"status" VARCHAR(50) NULL DEFAULT 'scheduled',
	"organized_by" UUID NULL DEFAULT NULL,
	"minutes_recorded_by" UUID NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	CONSTRAINT "meetings_minutes_recorded_by_fkey" FOREIGN KEY ("minutes_recorded_by") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "meetings_organized_by_fkey" FOREIGN KEY ("organized_by") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "meetings_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.meeting_attendance
CREATE TABLE IF NOT EXISTS "meeting_attendance" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"meeting_id" UUID NOT NULL,
	"member_id" UUID NOT NULL,
	"is_present" BOOLEAN NULL DEFAULT true,
	"attendance_time" TIMESTAMPTZ NULL DEFAULT NULL,
	PRIMARY KEY ("id"),
	UNIQUE ("meeting_id", "member_id"),
	CONSTRAINT "meeting_attendance_meeting_id_fkey" FOREIGN KEY ("meeting_id") REFERENCES "meetings" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "meeting_attendance_member_id_fkey" FOREIGN KEY ("member_id") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.members
CREATE TABLE IF NOT EXISTS "members" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"user_id" UUID NULL DEFAULT NULL,
	"member_type" UNKNOWN NOT NULL,
	"first_name" VARCHAR(100) NOT NULL,
	"middle_name" VARCHAR(100) NULL DEFAULT NULL,
	"last_name" VARCHAR(100) NOT NULL,
	"date_of_birth" DATE NULL DEFAULT NULL,
	"gender" VARCHAR(10) NULL DEFAULT NULL,
	"nationality" VARCHAR(50) NULL DEFAULT 'Indian',
	"primary_phone" VARCHAR(15) NOT NULL,
	"secondary_phone" VARCHAR(15) NULL DEFAULT NULL,
	"email" VARCHAR(255) NULL DEFAULT NULL,
	"emergency_contact_name" VARCHAR(255) NULL DEFAULT NULL,
	"emergency_contact_phone" VARCHAR(15) NULL DEFAULT NULL,
	"permanent_address" TEXT NULL DEFAULT NULL,
	"current_address" TEXT NULL DEFAULT NULL,
	"aadhar_number" VARCHAR(12) NULL DEFAULT NULL,
	"pan_number" VARCHAR(10) NULL DEFAULT NULL,
	"passport_number" VARCHAR(20) NULL DEFAULT NULL,
	"occupation" VARCHAR(255) NULL DEFAULT NULL,
	"organization" VARCHAR(255) NULL DEFAULT NULL,
	"designation" VARCHAR(255) NULL DEFAULT NULL,
	"membership_number" VARCHAR(50) NULL DEFAULT NULL,
	"joining_date" DATE NOT NULL DEFAULT CURRENT_DATE,
	"leaving_date" DATE NULL DEFAULT NULL,
	"is_active" BOOLEAN NULL DEFAULT true,
	"has_voting_rights" BOOLEAN NULL DEFAULT true,
	"profile_image_url" VARCHAR(500) NULL DEFAULT NULL,
	"bio" TEXT NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("membership_number"),
	UNIQUE ("society_id", "email"),
	KEY ("society_id"),
	CONSTRAINT "members_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "members_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for table society.member_licenses
CREATE TABLE IF NOT EXISTS "member_licenses" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"subscription_id" UUID NOT NULL,
	"member_id" UUID NOT NULL,
	"license_type" VARCHAR(50) NULL DEFAULT 'standard',
	"valid_from" DATE NOT NULL DEFAULT CURRENT_DATE,
	"valid_until" DATE NULL DEFAULT NULL,
	"is_active" BOOLEAN NULL DEFAULT true,
	"monthly_rate" NUMERIC(10,2) NOT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("subscription_id", "member_id"),
	KEY ("society_id"),
	KEY ("subscription_id"),
	KEY ("member_id"),
	CONSTRAINT "member_licenses_member_id_fkey" FOREIGN KEY ("member_id") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "member_licenses_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "member_licenses_subscription_id_fkey" FOREIGN KEY ("subscription_id") REFERENCES "society_subscriptions" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for view society.member_license_tracking
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "member_license_tracking" (
	"society_name" VARCHAR(1) NULL,
	"member_name" TEXT NULL,
	"email" VARCHAR(1) NULL,
	"member_type" UNKNOWN NULL,
	"license_type" VARCHAR(1) NULL,
	"monthly_rate" NUMERIC(10,2) NULL,
	"valid_from" DATE NULL,
	"valid_until" DATE NULL,
	"is_active" BOOLEAN NULL,
	"subscription_status" UNKNOWN NULL,
	"license_status" TEXT NULL
) ENGINE=MyISAM;

-- Dumping structure for view society.outstanding_bills_summary
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "outstanding_bills_summary" (
	"society_name" VARCHAR(1) NULL,
	"unit_number" VARCHAR(1) NULL,
	"owner_name" TEXT NULL,
	"owner_email" VARCHAR(1) NULL,
	"total_bills" BIGINT NULL,
	"total_outstanding" NUMERIC NULL,
	"oldest_due_date" DATE NULL
) ENGINE=MyISAM;

-- Dumping structure for table society.password_history
CREATE TABLE IF NOT EXISTS "password_history" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"user_id" UUID NOT NULL,
	"password_hash" VARCHAR(255) NOT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	CONSTRAINT "password_history_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.payments
CREATE TABLE IF NOT EXISTS "payments" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"bill_id" UUID NULL DEFAULT NULL,
	"unit_id" UUID NOT NULL,
	"member_id" UUID NULL DEFAULT NULL,
	"receipt_number" VARCHAR(100) NOT NULL,
	"payment_date" DATE NOT NULL DEFAULT CURRENT_DATE,
	"amount" NUMERIC(15,2) NOT NULL,
	"payment_method" UNKNOWN NOT NULL,
	"transaction_reference" VARCHAR(255) NULL DEFAULT NULL,
	"cheque_number" VARCHAR(50) NULL DEFAULT NULL,
	"cheque_date" DATE NULL DEFAULT NULL,
	"bank_name" VARCHAR(255) NULL DEFAULT NULL,
	"upi_id" VARCHAR(255) NULL DEFAULT NULL,
	"digital_receipt_url" VARCHAR(500) NULL DEFAULT NULL,
	"status" UNKNOWN NULL DEFAULT 'paid',
	"notes" TEXT NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("receipt_number"),
	KEY ("society_id"),
	KEY ("bill_id"),
	KEY ("payment_date"),
	CONSTRAINT "payments_bill_id_fkey" FOREIGN KEY ("bill_id") REFERENCES "bills" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "payments_member_id_fkey" FOREIGN KEY ("member_id") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "payments_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "payments_unit_id_fkey" FOREIGN KEY ("unit_id") REFERENCES "units" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for view society.pending_invitations
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "pending_invitations" (
	"id" UUID NULL,
	"invitation_token" VARCHAR(1) NULL,
	"society_name" VARCHAR(1) NULL,
	"email" VARCHAR(1) NULL,
	"first_name" VARCHAR(1) NULL,
	"last_name" VARCHAR(1) NULL,
	"role_name" VARCHAR(1) NULL,
	"unit_number" VARCHAR(1) NULL,
	"invited_by_username" VARCHAR(1) NULL,
	"sent_at" TIMESTAMPTZ NULL,
	"expires_at" TIMESTAMPTZ NULL
) ENGINE=MyISAM;

-- Dumping structure for table society.roles
CREATE TABLE IF NOT EXISTS "roles" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NULL DEFAULT NULL,
	"role_name" UNKNOWN NOT NULL,
	"display_name" VARCHAR(100) NOT NULL,
	"description" TEXT NULL DEFAULT NULL,
	"can_manage_society" BOOLEAN NULL DEFAULT false,
	"can_manage_members" BOOLEAN NULL DEFAULT false,
	"can_manage_finances" BOOLEAN NULL DEFAULT false,
	"can_manage_maintenance" BOOLEAN NULL DEFAULT false,
	"can_view_reports" BOOLEAN NULL DEFAULT false,
	"can_manage_staff" BOOLEAN NULL DEFAULT false,
	"can_manage_vendors" BOOLEAN NULL DEFAULT false,
	"can_manage_complaints" BOOLEAN NULL DEFAULT false,
	"can_manage_events" BOOLEAN NULL DEFAULT false,
	"can_manage_documents" BOOLEAN NULL DEFAULT false,
	"can_send_notifications" BOOLEAN NULL DEFAULT false,
	"can_approve_payments" BOOLEAN NULL DEFAULT false,
	"can_create_bills" BOOLEAN NULL DEFAULT false,
	"can_manage_visitors" BOOLEAN NULL DEFAULT false,
	"hierarchy_level" INTEGER NULL DEFAULT 0,
	"is_active" BOOLEAN NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("society_id", "role_name"),
	CONSTRAINT "roles_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.societies
CREATE TABLE IF NOT EXISTS "societies" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"name" VARCHAR(255) NOT NULL,
	"society_type" UNKNOWN NOT NULL,
	"registration_number" VARCHAR(100) NULL DEFAULT NULL,
	"registration_date" DATE NULL DEFAULT NULL,
	"established_date" DATE NULL DEFAULT NULL,
	"address_line1" VARCHAR(255) NOT NULL,
	"address_line2" VARCHAR(255) NULL DEFAULT NULL,
	"city" VARCHAR(100) NOT NULL,
	"state" VARCHAR(100) NOT NULL,
	"pincode" VARCHAR(10) NOT NULL,
	"country" VARCHAR(100) NULL DEFAULT 'India',
	"primary_phone" VARCHAR(15) NULL DEFAULT NULL,
	"secondary_phone" VARCHAR(15) NULL DEFAULT NULL,
	"email" VARCHAR(255) NULL DEFAULT NULL,
	"website" VARCHAR(255) NULL DEFAULT NULL,
	"pan_number" VARCHAR(10) NULL DEFAULT NULL,
	"tan_number" VARCHAR(10) NULL DEFAULT NULL,
	"gst_number" VARCHAR(15) NULL DEFAULT NULL,
	"bank_name" VARCHAR(255) NULL DEFAULT NULL,
	"bank_account_number" VARCHAR(50) NULL DEFAULT NULL,
	"bank_ifsc" VARCHAR(11) NULL DEFAULT NULL,
	"bank_branch" VARCHAR(255) NULL DEFAULT NULL,
	"founded_by" UUID NULL DEFAULT NULL,
	"current_chairman" UUID NULL DEFAULT NULL,
	"total_units" INTEGER NULL DEFAULT 0,
	"total_area_sqft" NUMERIC(10,2) NULL DEFAULT NULL,
	"common_area_sqft" NUMERIC(10,2) NULL DEFAULT NULL,
	"maintenance_due_day" INTEGER NULL DEFAULT 1,
	"late_fee_percentage" NUMERIC(5,2) NULL DEFAULT 0,
	"grace_period_days" INTEGER NULL DEFAULT 5,
	"is_active" BOOLEAN NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("registration_number"),
	KEY ("state"),
	CONSTRAINT "societies_current_chairman_fkey" FOREIGN KEY ("current_chairman") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "societies_founded_by_fkey" FOREIGN KEY ("founded_by") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for view society.society_dashboard
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "society_dashboard" (
	"id" UUID NULL,
	"name" VARCHAR(1) NULL,
	"society_type" UNKNOWN NULL,
	"total_units" INTEGER NULL,
	"total_members" BIGINT NULL,
	"total_owners" BIGINT NULL,
	"total_tenants" BIGINT NULL,
	"pending_bills" BIGINT NULL,
	"total_outstanding" NUMERIC NULL,
	"open_complaints" BIGINT NULL,
	"upcoming_events" BIGINT NULL,
	"current_visitors" BIGINT NULL,
	"todays_visitors" BIGINT NULL,
	"pending_visitor_approvals" BIGINT NULL,
	"subscription_status" UNKNOWN NULL,
	"licensed_members" INTEGER NULL,
	"used_members" INTEGER NULL,
	"available_licenses" INTEGER NULL,
	"subscription_end_date" DATE NULL,
	"subscription_days_remaining" INTEGER NULL,
	"monthly_subscription_cost" NUMERIC(15,2) NULL
) ENGINE=MyISAM;

-- Dumping structure for table society.society_subscriptions
CREATE TABLE IF NOT EXISTS "society_subscriptions" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"plan_id" UUID NOT NULL,
	"subscription_code" VARCHAR(50) NOT NULL,
	"status" UNKNOWN NULL DEFAULT 'trial',
	"licensed_members" INTEGER NOT NULL,
	"used_members" INTEGER NULL DEFAULT 0,
	"rate_per_member" NUMERIC(10,2) NOT NULL,
	"total_monthly_amount" NUMERIC(15,2) NOT NULL,
	"setup_fee" NUMERIC(10,2) NULL DEFAULT 0,
	"start_date" DATE NOT NULL DEFAULT CURRENT_DATE,
	"end_date" DATE NOT NULL,
	"trial_end_date" DATE NULL DEFAULT NULL,
	"next_billing_date" DATE NOT NULL,
	"last_billing_date" DATE NULL DEFAULT NULL,
	"auto_renew" BOOLEAN NULL DEFAULT true,
	"activated_by" VARCHAR(255) NULL DEFAULT NULL,
	"activated_at" TIMESTAMPTZ NULL DEFAULT NULL,
	"suspended_reason" TEXT NULL DEFAULT NULL,
	"cancelled_reason" TEXT NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("subscription_code"),
	KEY ("society_id"),
	KEY ("status"),
	KEY ("next_billing_date"),
	CONSTRAINT "society_subscriptions_plan_id_fkey" FOREIGN KEY ("plan_id") REFERENCES "subscription_plans" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "society_subscriptions_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.staff
CREATE TABLE IF NOT EXISTS "staff" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"employee_id" VARCHAR(50) NOT NULL,
	"first_name" VARCHAR(100) NOT NULL,
	"middle_name" VARCHAR(100) NULL DEFAULT NULL,
	"last_name" VARCHAR(100) NOT NULL,
	"date_of_birth" DATE NULL DEFAULT NULL,
	"gender" VARCHAR(10) NULL DEFAULT NULL,
	"primary_phone" VARCHAR(15) NOT NULL,
	"secondary_phone" VARCHAR(15) NULL DEFAULT NULL,
	"email" VARCHAR(255) NULL DEFAULT NULL,
	"current_address" TEXT NULL DEFAULT NULL,
	"permanent_address" TEXT NULL DEFAULT NULL,
	"aadhar_number" VARCHAR(12) NULL DEFAULT NULL,
	"pan_number" VARCHAR(10) NULL DEFAULT NULL,
	"designation" VARCHAR(255) NOT NULL,
	"department" VARCHAR(255) NULL DEFAULT NULL,
	"joining_date" DATE NOT NULL,
	"leaving_date" DATE NULL DEFAULT NULL,
	"salary" NUMERIC(10,2) NULL DEFAULT NULL,
	"shift_start_time" TIME NULL DEFAULT NULL,
	"shift_end_time" TIME NULL DEFAULT NULL,
	"weekly_off_days" UNKNOWN NULL DEFAULT NULL,
	"is_active" BOOLEAN NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("employee_id"),
	CONSTRAINT "staff_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for view society.subscription_billing_summary
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "subscription_billing_summary" (
	"society_name" VARCHAR(1) NULL,
	"subscription_code" VARCHAR(1) NULL,
	"plan_name" VARCHAR(1) NULL,
	"status" UNKNOWN NULL,
	"licensed_members" INTEGER NULL,
	"used_members" INTEGER NULL,
	"rate_per_member" NUMERIC(10,2) NULL,
	"total_monthly_amount" NUMERIC(15,2) NULL,
	"start_date" DATE NULL,
	"end_date" DATE NULL,
	"next_billing_date" DATE NULL,
	"total_payments" BIGINT NULL,
	"total_paid" NUMERIC NULL,
	"pending_amount" NUMERIC NULL,
	"last_payment_date" DATE NULL
) ENGINE=MyISAM;

-- Dumping structure for view society.subscription_expiry_alerts
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "subscription_expiry_alerts" (
	"society_id" UUID NULL,
	"society_name" VARCHAR(1) NULL,
	"primary_phone" VARCHAR(1) NULL,
	"email" VARCHAR(1) NULL,
	"chairman_email" VARCHAR(1) NULL,
	"subscription_code" VARCHAR(1) NULL,
	"end_date" DATE NULL,
	"days_remaining" INTEGER NULL,
	"total_monthly_amount" NUMERIC(15,2) NULL,
	"next_billing_date" DATE NULL,
	"alert_level" TEXT NULL
) ENGINE=MyISAM;

-- Dumping structure for table society.subscription_plans
CREATE TABLE IF NOT EXISTS "subscription_plans" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"plan_name" VARCHAR(100) NOT NULL,
	"plan_code" VARCHAR(20) NOT NULL,
	"description" TEXT NULL DEFAULT NULL,
	"rate_per_member" NUMERIC(10,2) NOT NULL,
	"minimum_members" INTEGER NULL DEFAULT 1,
	"maximum_members" INTEGER NULL DEFAULT NULL,
	"billing_cycle" VARCHAR(20) NULL DEFAULT 'monthly',
	"setup_fee" NUMERIC(10,2) NULL DEFAULT 0,
	"features" JSONB NULL DEFAULT NULL,
	"is_active" BOOLEAN NULL DEFAULT true,
	"valid_from" DATE NULL DEFAULT CURRENT_DATE,
	"valid_until" DATE NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("plan_code"),
	KEY ("is_active"),
	KEY ("plan_code")
);

-- Data exporting was unselected.

-- Dumping structure for table society.units
CREATE TABLE IF NOT EXISTS "units" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"unit_number" VARCHAR(50) NOT NULL,
	"unit_type" UNKNOWN NOT NULL,
	"floor_number" INTEGER NULL DEFAULT NULL,
	"building_name" VARCHAR(100) NULL DEFAULT NULL,
	"wing_name" VARCHAR(50) NULL DEFAULT NULL,
	"carpet_area_sqft" NUMERIC(10,2) NULL DEFAULT NULL,
	"built_up_area_sqft" NUMERIC(10,2) NULL DEFAULT NULL,
	"super_built_up_area_sqft" NUMERIC(10,2) NULL DEFAULT NULL,
	"bedrooms" INTEGER NULL DEFAULT 0,
	"bathrooms" INTEGER NULL DEFAULT 0,
	"balconies" INTEGER NULL DEFAULT 0,
	"ready_reckoner_value" NUMERIC(15,2) NULL DEFAULT NULL,
	"market_value" NUMERIC(15,2) NULL DEFAULT NULL,
	"is_occupied" BOOLEAN NULL DEFAULT false,
	"possession_date" DATE NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("society_id", "unit_number"),
	KEY ("society_id"),
	CONSTRAINT "units_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.unit_members
CREATE TABLE IF NOT EXISTS "unit_members" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"unit_id" UUID NOT NULL,
	"member_id" UUID NOT NULL,
	"relationship" VARCHAR(50) NOT NULL,
	"ownership_percentage" NUMERIC(5,2) NULL DEFAULT 100.00,
	"start_date" DATE NOT NULL DEFAULT CURRENT_DATE,
	"end_date" DATE NULL DEFAULT NULL,
	"monthly_rent" NUMERIC(10,2) NULL DEFAULT NULL,
	"security_deposit" NUMERIC(10,2) NULL DEFAULT NULL,
	"rent_due_date" INTEGER NULL DEFAULT 1,
	"agreement_number" VARCHAR(100) NULL DEFAULT NULL,
	"agreement_date" DATE NULL DEFAULT NULL,
	"is_primary" BOOLEAN NULL DEFAULT false,
	"is_active" BOOLEAN NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("unit_id", "member_id", "relationship"),
	KEY ("unit_id"),
	KEY ("member_id"),
	CONSTRAINT "unit_members_member_id_fkey" FOREIGN KEY ("member_id") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "unit_members_unit_id_fkey" FOREIGN KEY ("unit_id") REFERENCES "units" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.users
CREATE TABLE IF NOT EXISTS "users" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"username" VARCHAR(50) NOT NULL,
	"email" VARCHAR(255) NOT NULL,
	"password_hash" VARCHAR(255) NOT NULL,
	"first_name" VARCHAR(100) NOT NULL,
	"last_name" VARCHAR(100) NOT NULL,
	"phone" VARCHAR(15) NULL DEFAULT NULL,
	"status" UNKNOWN NULL DEFAULT 'pending_verification',
	"email_verified" BOOLEAN NULL DEFAULT false,
	"phone_verified" BOOLEAN NULL DEFAULT false,
	"failed_login_attempts" INTEGER NULL DEFAULT 0,
	"account_locked_until" TIMESTAMPTZ NULL DEFAULT NULL,
	"password_reset_token" VARCHAR(255) NULL DEFAULT NULL,
	"password_reset_expires" TIMESTAMPTZ NULL DEFAULT NULL,
	"email_verification_token" VARCHAR(255) NULL DEFAULT NULL,
	"email_verification_expires" TIMESTAMPTZ NULL DEFAULT NULL,
	"last_login" TIMESTAMPTZ NULL DEFAULT NULL,
	"last_login_ip" INET NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"created_by" UUID NULL DEFAULT NULL,
	PRIMARY KEY ("id"),
	UNIQUE ("username"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	UNIQUE ("email"),
	KEY ("email"),
	KEY ("username"),
	KEY ("status"),
	CONSTRAINT "users_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for table society.user_audit_log
CREATE TABLE IF NOT EXISTS "user_audit_log" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"user_id" UUID NULL DEFAULT NULL,
	"society_id" UUID NULL DEFAULT NULL,
	"action" VARCHAR(100) NOT NULL,
	"resource_type" VARCHAR(100) NULL DEFAULT NULL,
	"resource_id" UUID NULL DEFAULT NULL,
	"details" JSONB NULL DEFAULT NULL,
	"ip_address" INET NULL DEFAULT NULL,
	"user_agent" TEXT NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	CONSTRAINT "user_audit_log_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "user_audit_log_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for view society.user_permissions
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "user_permissions" (
	"user_id" UUID NULL,
	"username" VARCHAR(1) NULL,
	"email" VARCHAR(1) NULL,
	"society_id" UUID NULL,
	"society_name" VARCHAR(1) NULL,
	"role_name" UNKNOWN NULL,
	"role_display_name" VARCHAR(1) NULL,
	"can_manage_society" BOOLEAN NULL,
	"can_manage_members" BOOLEAN NULL,
	"can_manage_finances" BOOLEAN NULL,
	"can_manage_maintenance" BOOLEAN NULL,
	"can_view_reports" BOOLEAN NULL,
	"can_manage_staff" BOOLEAN NULL,
	"can_manage_vendors" BOOLEAN NULL,
	"can_manage_complaints" BOOLEAN NULL,
	"can_manage_events" BOOLEAN NULL,
	"can_manage_documents" BOOLEAN NULL,
	"can_send_notifications" BOOLEAN NULL,
	"can_approve_payments" BOOLEAN NULL,
	"can_create_bills" BOOLEAN NULL,
	"can_manage_visitors" BOOLEAN NULL,
	"valid_from" DATE NULL,
	"valid_until" DATE NULL
) ENGINE=MyISAM;

-- Dumping structure for table society.user_roles
CREATE TABLE IF NOT EXISTS "user_roles" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"user_id" UUID NOT NULL,
	"society_id" UUID NOT NULL,
	"role_id" UUID NOT NULL,
	"assigned_by" UUID NULL DEFAULT NULL,
	"assigned_date" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"valid_from" DATE NOT NULL DEFAULT CURRENT_DATE,
	"valid_until" DATE NULL DEFAULT NULL,
	"is_active" BOOLEAN NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("user_id", "society_id", "role_id"),
	KEY ("user_id", "society_id"),
	CONSTRAINT "user_roles_assigned_by_fkey" FOREIGN KEY ("assigned_by") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "user_roles_role_id_fkey" FOREIGN KEY ("role_id") REFERENCES "roles" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "user_roles_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "user_roles_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.user_sessions
CREATE TABLE IF NOT EXISTS "user_sessions" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"user_id" UUID NOT NULL,
	"society_id" UUID NULL DEFAULT NULL,
	"session_token" VARCHAR(255) NOT NULL,
	"device_info" VARCHAR(500) NULL DEFAULT NULL,
	"ip_address" INET NULL DEFAULT NULL,
	"user_agent" TEXT NULL DEFAULT NULL,
	"is_active" BOOLEAN NULL DEFAULT true,
	"expires_at" TIMESTAMPTZ NOT NULL,
	"last_activity" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("session_token"),
	KEY ("session_token"),
	KEY ("user_id"),
	CONSTRAINT "user_sessions_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "user_sessions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.vendors
CREATE TABLE IF NOT EXISTS "vendors" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"vendor_code" VARCHAR(50) NOT NULL,
	"business_name" VARCHAR(255) NOT NULL,
	"contact_person" VARCHAR(255) NULL DEFAULT NULL,
	"primary_phone" VARCHAR(15) NOT NULL,
	"secondary_phone" VARCHAR(15) NULL DEFAULT NULL,
	"email" VARCHAR(255) NULL DEFAULT NULL,
	"website" VARCHAR(255) NULL DEFAULT NULL,
	"address" TEXT NULL DEFAULT NULL,
	"city" VARCHAR(100) NULL DEFAULT NULL,
	"state" VARCHAR(100) NULL DEFAULT NULL,
	"pincode" VARCHAR(10) NULL DEFAULT NULL,
	"service_category" VARCHAR(255) NULL DEFAULT NULL,
	"services_provided" UNKNOWN NULL DEFAULT NULL,
	"pan_number" VARCHAR(10) NULL DEFAULT NULL,
	"gst_number" VARCHAR(15) NULL DEFAULT NULL,
	"bank_name" VARCHAR(255) NULL DEFAULT NULL,
	"account_number" VARCHAR(50) NULL DEFAULT NULL,
	"ifsc_code" VARCHAR(11) NULL DEFAULT NULL,
	"contract_start_date" DATE NULL DEFAULT NULL,
	"contract_end_date" DATE NULL DEFAULT NULL,
	"contract_value" NUMERIC(15,2) NULL DEFAULT NULL,
	"is_active" BOOLEAN NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("vendor_code"),
	CONSTRAINT "vendors_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.visitor_access_control
CREATE TABLE IF NOT EXISTS "visitor_access_control" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"person_name" VARCHAR(255) NOT NULL,
	"person_phone" VARCHAR(15) NULL DEFAULT NULL,
	"person_id_proof" VARCHAR(50) NULL DEFAULT NULL,
	"person_photo_url" VARCHAR(500) NULL DEFAULT NULL,
	"access_type" VARCHAR(20) NOT NULL,
	"reason" TEXT NOT NULL,
	"restrictions" JSONB NULL DEFAULT NULL,
	"effective_from" DATE NOT NULL DEFAULT CURRENT_DATE,
	"effective_until" DATE NULL DEFAULT NULL,
	"added_by" UUID NOT NULL,
	"approved_by" UUID NULL DEFAULT NULL,
	"is_active" BOOLEAN NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	KEY ("society_id"),
	KEY ("person_phone"),
	CONSTRAINT "visitor_access_control_added_by_fkey" FOREIGN KEY ("added_by") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_access_control_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_access_control_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for view society.visitor_access_control_summary
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "visitor_access_control_summary" (
	"society_name" VARCHAR(1) NULL,
	"person_name" VARCHAR(1) NULL,
	"person_phone" VARCHAR(1) NULL,
	"access_type" VARCHAR(1) NULL,
	"reason" TEXT NULL,
	"effective_from" DATE NULL,
	"effective_until" DATE NULL,
	"added_by_username" VARCHAR(1) NULL,
	"is_active" BOOLEAN NULL
) ENGINE=MyISAM;

-- Dumping structure for table society.visitor_analytics
CREATE TABLE IF NOT EXISTS "visitor_analytics" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"report_date" DATE NOT NULL,
	"hour_of_day" INTEGER NULL DEFAULT NULL,
	"total_entries" INTEGER NULL DEFAULT 0,
	"total_exits" INTEGER NULL DEFAULT 0,
	"total_unique_visitors" INTEGER NULL DEFAULT 0,
	"avg_visit_duration_minutes" INTEGER NULL DEFAULT 0,
	"guest_count" INTEGER NULL DEFAULT 0,
	"delivery_count" INTEGER NULL DEFAULT 0,
	"service_provider_count" INTEGER NULL DEFAULT 0,
	"vendor_count" INTEGER NULL DEFAULT 0,
	"denied_entries" INTEGER NULL DEFAULT 0,
	"overstay_incidents" INTEGER NULL DEFAULT 0,
	"security_alerts" INTEGER NULL DEFAULT 0,
	"avg_visitor_rating" NUMERIC(3,2) NULL DEFAULT NULL,
	"avg_host_rating" NUMERIC(3,2) NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("society_id", "report_date", "hour_of_day"),
	KEY ("society_id", "report_date"),
	CONSTRAINT "visitor_analytics_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for view society.visitor_analytics_summary
-- Creating temporary table to overcome VIEW dependency errors
CREATE TABLE "visitor_analytics_summary" (
	"society_name" VARCHAR(1) NULL,
	"month" DATE NULL,
	"total_visits" BIGINT NULL,
	"unique_visitors" BIGINT NULL,
	"deliveries" BIGINT NULL,
	"guests" BIGINT NULL,
	"service_providers" BIGINT NULL,
	"denied_entries" BIGINT NULL,
	"avg_visit_duration_minutes" NUMERIC NULL,
	"avg_visitor_rating" NUMERIC NULL,
	"avg_host_rating" NUMERIC NULL
) ENGINE=MyISAM;

-- Dumping structure for table society.visitor_logs
CREATE TABLE IF NOT EXISTS "visitor_logs" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"unit_id" UUID NOT NULL,
	"registration_id" UUID NULL DEFAULT NULL,
	"pass_id" UUID NULL DEFAULT NULL,
	"gate_id" UUID NULL DEFAULT NULL,
	"visitor_name" VARCHAR(255) NOT NULL,
	"visitor_phone" VARCHAR(15) NULL DEFAULT NULL,
	"visitor_type" UNKNOWN NOT NULL,
	"purpose_of_visit" TEXT NULL DEFAULT NULL,
	"id_proof_type" VARCHAR(50) NULL DEFAULT NULL,
	"id_proof_number" VARCHAR(50) NULL DEFAULT NULL,
	"visitor_photo_url" VARCHAR(500) NULL DEFAULT NULL,
	"vehicle_number" VARCHAR(20) NULL DEFAULT NULL,
	"vehicle_type" UNKNOWN NULL DEFAULT NULL,
	"parking_slot" VARCHAR(50) NULL DEFAULT NULL,
	"check_in_time" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"check_out_time" TIMESTAMPTZ NULL DEFAULT NULL,
	"actual_checkout_time" TIMESTAMPTZ NULL DEFAULT NULL,
	"security_guard_id" UUID NULL DEFAULT NULL,
	"security_notes" TEXT NULL DEFAULT NULL,
	"host_notified" BOOLEAN NULL DEFAULT false,
	"host_notification_time" TIMESTAMPTZ NULL DEFAULT NULL,
	"approved_by" UUID NULL DEFAULT NULL,
	"approval_method" VARCHAR(50) NULL DEFAULT NULL,
	"status" UNKNOWN NOT NULL,
	"temperature_recorded" NUMERIC(4,1) NULL DEFAULT NULL,
	"health_declaration" BOOLEAN NULL DEFAULT false,
	"emergency_contact_name" VARCHAR(255) NULL DEFAULT NULL,
	"emergency_contact_phone" VARCHAR(15) NULL DEFAULT NULL,
	"visitor_rating" INTEGER NULL DEFAULT NULL,
	"visitor_feedback" TEXT NULL DEFAULT NULL,
	"host_rating" INTEGER NULL DEFAULT NULL,
	"host_feedback" TEXT NULL DEFAULT NULL,
	"entry_method" VARCHAR(50) NULL DEFAULT NULL,
	"device_info" VARCHAR(255) NULL DEFAULT NULL,
	"ip_address" INET NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	KEY ("society_id"),
	KEY ("check_in_time"),
	KEY ("status"),
	KEY ("gate_id"),
	CONSTRAINT "visitor_logs_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_logs_gate_id_fkey" FOREIGN KEY ("gate_id") REFERENCES "gates" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_logs_pass_id_fkey" FOREIGN KEY ("pass_id") REFERENCES "visitor_passes" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_logs_registration_id_fkey" FOREIGN KEY ("registration_id") REFERENCES "visitor_registrations" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_logs_security_guard_id_fkey" FOREIGN KEY ("security_guard_id") REFERENCES "staff" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_logs_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "visitor_logs_unit_id_fkey" FOREIGN KEY ("unit_id") REFERENCES "units" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "visitor_logs_visitor_rating_check" CHECK (((visitor_rating >= 1) AND (visitor_rating <= 5))),
	CONSTRAINT "visitor_logs_host_rating_check" CHECK (((host_rating >= 1) AND (host_rating <= 5)))
);

-- Data exporting was unselected.

-- Dumping structure for table society.visitor_notifications
CREATE TABLE IF NOT EXISTS "visitor_notifications" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"visitor_log_id" UUID NULL DEFAULT NULL,
	"registration_id" UUID NULL DEFAULT NULL,
	"notification_type" VARCHAR(50) NOT NULL,
	"recipient_user_id" UUID NULL DEFAULT NULL,
	"recipient_phone" VARCHAR(15) NULL DEFAULT NULL,
	"recipient_email" VARCHAR(255) NULL DEFAULT NULL,
	"subject" VARCHAR(255) NULL DEFAULT NULL,
	"message" TEXT NOT NULL,
	"delivery_method" VARCHAR(20) NOT NULL,
	"sent_at" TIMESTAMPTZ NULL DEFAULT NULL,
	"delivered_at" TIMESTAMPTZ NULL DEFAULT NULL,
	"read_at" TIMESTAMPTZ NULL DEFAULT NULL,
	"status" VARCHAR(20) NULL DEFAULT 'pending',
	"failure_reason" TEXT NULL DEFAULT NULL,
	"retry_count" INTEGER NULL DEFAULT 0,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	KEY ("recipient_user_id"),
	KEY ("status"),
	CONSTRAINT "visitor_notifications_recipient_user_id_fkey" FOREIGN KEY ("recipient_user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_notifications_registration_id_fkey" FOREIGN KEY ("registration_id") REFERENCES "visitor_registrations" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_notifications_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "visitor_notifications_visitor_log_id_fkey" FOREIGN KEY ("visitor_log_id") REFERENCES "visitor_logs" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION
);

-- Data exporting was unselected.

-- Dumping structure for table society.visitor_passes
CREATE TABLE IF NOT EXISTS "visitor_passes" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"registration_id" UUID NULL DEFAULT NULL,
	"pass_number" VARCHAR(50) NOT NULL,
	"qr_code" VARCHAR(500) NOT NULL,
	"pass_type" UNKNOWN NOT NULL,
	"issued_to_name" VARCHAR(255) NOT NULL,
	"issued_to_phone" VARCHAR(15) NULL DEFAULT NULL,
	"issued_by" UUID NULL DEFAULT NULL,
	"issued_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"valid_from" TIMESTAMPTZ NOT NULL,
	"valid_until" TIMESTAMPTZ NOT NULL,
	"max_entries" INTEGER NULL DEFAULT 1,
	"current_entries" INTEGER NULL DEFAULT 0,
	"is_active" BOOLEAN NULL DEFAULT true,
	"allowed_gates" UNKNOWN NULL DEFAULT NULL,
	"allowed_days" UNKNOWN NULL DEFAULT NULL,
	"allowed_time_from" TIME NULL DEFAULT NULL,
	"allowed_time_to" TIME NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	UNIQUE ("pass_number"),
	KEY ("society_id"),
	KEY ("qr_code"),
	KEY ("valid_from", "valid_until"),
	CONSTRAINT "visitor_passes_issued_by_fkey" FOREIGN KEY ("issued_by") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_passes_registration_id_fkey" FOREIGN KEY ("registration_id") REFERENCES "visitor_registrations" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_passes_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.visitor_registrations
CREATE TABLE IF NOT EXISTS "visitor_registrations" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"society_id" UUID NOT NULL,
	"unit_id" UUID NOT NULL,
	"registered_by" UUID NOT NULL,
	"visitor_name" VARCHAR(255) NOT NULL,
	"visitor_phone" VARCHAR(15) NULL DEFAULT NULL,
	"visitor_email" VARCHAR(255) NULL DEFAULT NULL,
	"visitor_company" VARCHAR(255) NULL DEFAULT NULL,
	"visitor_designation" VARCHAR(255) NULL DEFAULT NULL,
	"visitor_type" UNKNOWN NOT NULL,
	"purpose_of_visit" TEXT NOT NULL,
	"expected_date" DATE NOT NULL,
	"expected_time_from" TIME NULL DEFAULT NULL,
	"expected_time_to" TIME NULL DEFAULT NULL,
	"emergency_contact_name" VARCHAR(255) NULL DEFAULT NULL,
	"emergency_contact_phone" VARCHAR(15) NULL DEFAULT NULL,
	"id_proof_type" VARCHAR(50) NULL DEFAULT NULL,
	"id_proof_number" VARCHAR(50) NULL DEFAULT NULL,
	"status" UNKNOWN NULL DEFAULT 'pending_approval',
	"approved_by" UUID NULL DEFAULT NULL,
	"approved_at" TIMESTAMPTZ NULL DEFAULT NULL,
	"approval_notes" TEXT NULL DEFAULT NULL,
	"valid_from" TIMESTAMPTZ NOT NULL,
	"valid_until" TIMESTAMPTZ NOT NULL,
	"is_recurring" BOOLEAN NULL DEFAULT false,
	"recurring_pattern" VARCHAR(50) NULL DEFAULT NULL,
	"max_visits_allowed" INTEGER NULL DEFAULT 1,
	"current_visit_count" INTEGER NULL DEFAULT 0,
	"visitor_photo_url" VARCHAR(500) NULL DEFAULT NULL,
	"supporting_documents" JSONB NULL DEFAULT NULL,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	KEY ("society_id"),
	KEY ("unit_id"),
	KEY ("status"),
	KEY ("expected_date"),
	CONSTRAINT "visitor_registrations_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_registrations_registered_by_fkey" FOREIGN KEY ("registered_by") REFERENCES "members" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION,
	CONSTRAINT "visitor_registrations_society_id_fkey" FOREIGN KEY ("society_id") REFERENCES "societies" ("id") ON UPDATE NO ACTION ON DELETE CASCADE,
	CONSTRAINT "visitor_registrations_unit_id_fkey" FOREIGN KEY ("unit_id") REFERENCES "units" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Dumping structure for table society.visitor_vehicles
CREATE TABLE IF NOT EXISTS "visitor_vehicles" (
	"id" UUID NOT NULL DEFAULT uuid_generate_v4(),
	"visitor_registration_id" UUID NOT NULL,
	"vehicle_number" VARCHAR(20) NOT NULL,
	"vehicle_type" UNKNOWN NOT NULL,
	"vehicle_make" VARCHAR(100) NULL DEFAULT NULL,
	"vehicle_model" VARCHAR(100) NULL DEFAULT NULL,
	"vehicle_color" VARCHAR(50) NULL DEFAULT NULL,
	"driver_name" VARCHAR(255) NULL DEFAULT NULL,
	"driver_phone" VARCHAR(15) NULL DEFAULT NULL,
	"driver_license_number" VARCHAR(50) NULL DEFAULT NULL,
	"requires_parking" BOOLEAN NULL DEFAULT true,
	"parking_slot_assigned" VARCHAR(50) NULL DEFAULT NULL,
	"parking_fee" NUMERIC(10,2) NULL DEFAULT 0,
	"created_at" TIMESTAMPTZ NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY ("id"),
	CONSTRAINT "visitor_vehicles_visitor_registration_id_fkey" FOREIGN KEY ("visitor_registration_id") REFERENCES "visitor_registrations" ("id") ON UPDATE NO ACTION ON DELETE CASCADE
);

-- Data exporting was unselected.

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "active_member_units";
CREATE VIEW "active_member_units" AS  SELECT s.name AS society_name,
    u.username,
    (((m.first_name)::text || ' '::text) || (m.last_name)::text) AS member_name,
    m.member_type,
    un.unit_number,
    un.unit_type,
    um.relationship,
    um.ownership_percentage,
    r.role_name,
    r.display_name AS role_display_name
   FROM ((((((members m
     JOIN unit_members um ON ((m.id = um.member_id)))
     JOIN units un ON ((um.unit_id = un.id)))
     JOIN societies s ON ((m.society_id = s.id)))
     LEFT JOIN users u ON ((m.user_id = u.id)))
     LEFT JOIN user_roles ur ON (((u.id = ur.user_id) AND (s.id = ur.society_id) AND (ur.is_active = true))))
     LEFT JOIN roles r ON ((ur.role_id = r.id)))
  WHERE ((m.is_active = true) AND (um.is_active = true));
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "company_payment_tracking";
CREATE VIEW "company_payment_tracking" AS  SELECT s.name AS society_name,
    cp.payment_reference,
    cp.amount,
    cp.member_count,
    cp.payment_method,
    cp.status,
    cp.billing_period_start,
    cp.billing_period_end,
    cp.due_date,
    cp.payment_date,
    cp.processed_by,
    cp.transaction_id,
        CASE
            WHEN ((cp.status = 'pending'::company_payment_status) AND (cp.due_date < CURRENT_DATE)) THEN 'Overdue'::text
            WHEN (cp.status = 'pending'::company_payment_status) THEN 'Pending'::text
            WHEN (cp.status = 'completed'::company_payment_status) THEN 'Paid'::text
            ELSE (cp.status)::text
        END AS payment_status
   FROM (company_payments cp
     JOIN societies s ON ((cp.society_id = s.id)))
  ORDER BY cp.due_date DESC, s.name;
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "current_visitors";
CREATE VIEW "current_visitors" AS  SELECT vl.id,
    s.name AS society_name,
    un.unit_number,
    vl.visitor_name,
    vl.visitor_phone,
    vl.visitor_type,
    vl.purpose_of_visit,
    vl.check_in_time,
    (EXTRACT(epoch FROM (CURRENT_TIMESTAMP - vl.check_in_time)) / (60)::numeric) AS minutes_inside,
    vl.vehicle_number,
    g.gate_name AS entry_gate,
    (((st.first_name)::text || ' '::text) || (st.last_name)::text) AS security_guard,
    vl.status
   FROM ((((visitor_logs vl
     JOIN societies s ON ((vl.society_id = s.id)))
     JOIN units un ON ((vl.unit_id = un.id)))
     LEFT JOIN gates g ON ((vl.gate_id = g.id)))
     LEFT JOIN staff st ON ((vl.security_guard_id = st.id)))
  WHERE (vl.status = ANY (ARRAY['checked_in'::visitor_status, 'overstayed'::visitor_status]))
  ORDER BY vl.check_in_time;
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "gate_activity_summary";
CREATE VIEW "gate_activity_summary" AS  SELECT s.name AS society_name,
    g.gate_name,
    (date_trunc('day'::text, gal.activity_timestamp))::date AS activity_date,
    count(
        CASE
            WHEN ((gal.activity_type)::text = 'entry'::text) THEN 1
            ELSE NULL::integer
        END) AS total_entries,
    count(
        CASE
            WHEN ((gal.activity_type)::text = 'exit'::text) THEN 1
            ELSE NULL::integer
        END) AS total_exits,
    count(
        CASE
            WHEN ((gal.activity_type)::text = 'denied'::text) THEN 1
            ELSE NULL::integer
        END) AS denied_attempts,
    count(
        CASE
            WHEN (gal.alert_triggered = true) THEN 1
            ELSE NULL::integer
        END) AS security_alerts
   FROM ((gate_activity_logs gal
     JOIN gates g ON ((gal.gate_id = g.id)))
     JOIN societies s ON ((gal.society_id = s.id)))
  WHERE (gal.activity_timestamp >= (CURRENT_DATE - '30 days'::interval))
  GROUP BY s.id, s.name, g.id, g.gate_name, (date_trunc('day'::text, gal.activity_timestamp))
  ORDER BY s.name, g.gate_name, ((date_trunc('day'::text, gal.activity_timestamp))::date) DESC;
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "member_license_tracking";
CREATE VIEW "member_license_tracking" AS  SELECT s.name AS society_name,
    (((m.first_name)::text || ' '::text) || (m.last_name)::text) AS member_name,
    m.email,
    m.member_type,
    ml.license_type,
    ml.monthly_rate,
    ml.valid_from,
    ml.valid_until,
    ml.is_active,
    ss.status AS subscription_status,
        CASE
            WHEN (ml.valid_until < CURRENT_DATE) THEN 'Expired'::text
            WHEN (ss.status = 'suspended'::subscription_status) THEN 'Suspended'::text
            WHEN ml.is_active THEN 'Active'::text
            ELSE 'Inactive'::text
        END AS license_status
   FROM (((member_licenses ml
     JOIN members m ON ((ml.member_id = m.id)))
     JOIN societies s ON ((ml.society_id = s.id)))
     JOIN society_subscriptions ss ON ((ml.subscription_id = ss.id)))
  ORDER BY s.name, m.first_name, m.last_name;
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "outstanding_bills_summary";
CREATE VIEW "outstanding_bills_summary" AS  SELECT s.name AS society_name,
    un.unit_number,
    (((m.first_name)::text || ' '::text) || (m.last_name)::text) AS owner_name,
    u.email AS owner_email,
    count(b.id) AS total_bills,
    sum(b.pending_amount) AS total_outstanding,
    min(b.due_date) AS oldest_due_date
   FROM (((((bills b
     JOIN units un ON ((b.unit_id = un.id)))
     JOIN societies s ON ((b.society_id = s.id)))
     LEFT JOIN unit_members um ON (((un.id = um.unit_id) AND ((um.relationship)::text = 'owner'::text) AND (um.is_active = true))))
     LEFT JOIN members m ON ((um.member_id = m.id)))
     LEFT JOIN users u ON ((m.user_id = u.id)))
  WHERE (b.status = ANY (ARRAY['pending'::payment_status, 'overdue'::payment_status]))
  GROUP BY s.id, s.name, un.id, un.unit_number, m.first_name, m.last_name, u.email;
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "pending_invitations";
CREATE VIEW "pending_invitations" AS  SELECT i.id,
    i.invitation_token,
    s.name AS society_name,
    i.email,
    i.first_name,
    i.last_name,
    r.display_name AS role_name,
    un.unit_number,
    u.username AS invited_by_username,
    i.sent_at,
    i.expires_at
   FROM ((((invitations i
     JOIN societies s ON ((i.society_id = s.id)))
     JOIN roles r ON ((i.role_id = r.id)))
     JOIN users u ON ((i.invited_by = u.id)))
     LEFT JOIN units un ON ((i.unit_id = un.id)))
  WHERE ((i.status = 'pending'::invitation_status) AND (i.expires_at > CURRENT_TIMESTAMP));
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "society_dashboard";
CREATE VIEW "society_dashboard" AS  SELECT s.id,
    s.name,
    s.society_type,
    s.total_units,
    count(DISTINCT m.id) AS total_members,
    count(DISTINCT
        CASE
            WHEN (m.member_type = 'owner'::member_type) THEN m.id
            ELSE NULL::uuid
        END) AS total_owners,
    count(DISTINCT
        CASE
            WHEN (m.member_type = 'tenant'::member_type) THEN m.id
            ELSE NULL::uuid
        END) AS total_tenants,
    count(DISTINCT
        CASE
            WHEN (b.status = ANY (ARRAY['pending'::payment_status, 'overdue'::payment_status])) THEN b.id
            ELSE NULL::uuid
        END) AS pending_bills,
    COALESCE(sum(
        CASE
            WHEN (b.status = ANY (ARRAY['pending'::payment_status, 'overdue'::payment_status])) THEN b.pending_amount
            ELSE (0)::numeric
        END), (0)::numeric) AS total_outstanding,
    count(DISTINCT
        CASE
            WHEN (c.status = 'open'::complaint_status) THEN c.id
            ELSE NULL::uuid
        END) AS open_complaints,
    count(DISTINCT
        CASE
            WHEN (e.start_date >= CURRENT_DATE) THEN e.id
            ELSE NULL::uuid
        END) AS upcoming_events,
    count(DISTINCT
        CASE
            WHEN (vl.status = 'checked_in'::visitor_status) THEN vl.id
            ELSE NULL::uuid
        END) AS current_visitors,
    count(DISTINCT
        CASE
            WHEN ((vl.check_in_time)::date = CURRENT_DATE) THEN vl.id
            ELSE NULL::uuid
        END) AS todays_visitors,
    count(DISTINCT
        CASE
            WHEN (vr.status = 'pending_approval'::visitor_status) THEN vr.id
            ELSE NULL::uuid
        END) AS pending_visitor_approvals,
    ss.status AS subscription_status,
    ss.licensed_members,
    ss.used_members,
    (ss.licensed_members - ss.used_members) AS available_licenses,
    ss.end_date AS subscription_end_date,
    (ss.end_date - CURRENT_DATE) AS subscription_days_remaining,
    ss.total_monthly_amount AS monthly_subscription_cost
   FROM (((((((societies s
     LEFT JOIN members m ON (((s.id = m.society_id) AND (m.is_active = true))))
     LEFT JOIN bills b ON ((s.id = b.society_id)))
     LEFT JOIN complaints c ON ((s.id = c.society_id)))
     LEFT JOIN events e ON (((s.id = e.society_id) AND (e.is_active = true))))
     LEFT JOIN visitor_logs vl ON ((s.id = vl.society_id)))
     LEFT JOIN visitor_registrations vr ON ((s.id = vr.society_id)))
     LEFT JOIN society_subscriptions ss ON (((s.id = ss.society_id) AND (ss.status = ANY (ARRAY['trial'::subscription_status, 'active'::subscription_status])))))
  WHERE (s.is_active = true)
  GROUP BY s.id, s.name, s.society_type, s.total_units, ss.status, ss.licensed_members, ss.used_members, ss.end_date, ss.total_monthly_amount;
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "subscription_billing_summary";
CREATE VIEW "subscription_billing_summary" AS  SELECT s.name AS society_name,
    ss.subscription_code,
    sp.plan_name,
    ss.status,
    ss.licensed_members,
    ss.used_members,
    ss.rate_per_member,
    ss.total_monthly_amount,
    ss.start_date,
    ss.end_date,
    ss.next_billing_date,
    count(cp.id) AS total_payments,
    COALESCE(sum(
        CASE
            WHEN (cp.status = 'completed'::company_payment_status) THEN cp.amount
            ELSE (0)::numeric
        END), (0)::numeric) AS total_paid,
    COALESCE(sum(
        CASE
            WHEN (cp.status = 'pending'::company_payment_status) THEN cp.amount
            ELSE (0)::numeric
        END), (0)::numeric) AS pending_amount,
    max(cp.payment_date) AS last_payment_date
   FROM (((society_subscriptions ss
     JOIN societies s ON ((ss.society_id = s.id)))
     JOIN subscription_plans sp ON ((ss.plan_id = sp.id)))
     LEFT JOIN company_payments cp ON ((ss.id = cp.subscription_id)))
  GROUP BY s.id, s.name, ss.id, ss.subscription_code, sp.plan_name, ss.status, ss.licensed_members, ss.used_members, ss.rate_per_member, ss.total_monthly_amount, ss.start_date, ss.end_date, ss.next_billing_date
  ORDER BY s.name;
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "subscription_expiry_alerts";
CREATE VIEW "subscription_expiry_alerts" AS  SELECT s.id AS society_id,
    s.name AS society_name,
    s.primary_phone,
    s.email,
    u.email AS chairman_email,
    ss.subscription_code,
    ss.end_date,
    (ss.end_date - CURRENT_DATE) AS days_remaining,
    ss.total_monthly_amount,
    ss.next_billing_date,
        CASE
            WHEN (ss.end_date < CURRENT_DATE) THEN 'EXPIRED'::text
            WHEN ((ss.end_date - CURRENT_DATE) <= 7) THEN 'CRITICAL'::text
            WHEN ((ss.end_date - CURRENT_DATE) <= 30) THEN 'WARNING'::text
            ELSE 'OK'::text
        END AS alert_level
   FROM ((society_subscriptions ss
     JOIN societies s ON ((ss.society_id = s.id)))
     LEFT JOIN users u ON ((s.current_chairman = u.id)))
  WHERE ((ss.status = ANY (ARRAY['trial'::subscription_status, 'active'::subscription_status])) AND ((ss.end_date - CURRENT_DATE) <= 30))
  ORDER BY ss.end_date;
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "user_permissions";
CREATE VIEW "user_permissions" AS  SELECT u.id AS user_id,
    u.username,
    u.email,
    s.id AS society_id,
    s.name AS society_name,
    r.role_name,
    r.display_name AS role_display_name,
    r.can_manage_society,
    r.can_manage_members,
    r.can_manage_finances,
    r.can_manage_maintenance,
    r.can_view_reports,
    r.can_manage_staff,
    r.can_manage_vendors,
    r.can_manage_complaints,
    r.can_manage_events,
    r.can_manage_documents,
    r.can_send_notifications,
    r.can_approve_payments,
    r.can_create_bills,
    r.can_manage_visitors,
    ur.valid_from,
    ur.valid_until
   FROM (((users u
     JOIN user_roles ur ON ((u.id = ur.user_id)))
     JOIN roles r ON ((ur.role_id = r.id)))
     JOIN societies s ON ((ur.society_id = s.id)))
  WHERE ((u.status = 'active'::user_status) AND (ur.is_active = true) AND (r.is_active = true) AND ((ur.valid_until IS NULL) OR (ur.valid_until >= CURRENT_DATE)));
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "visitor_access_control_summary";
CREATE VIEW "visitor_access_control_summary" AS  SELECT s.name AS society_name,
    vac.person_name,
    vac.person_phone,
    vac.access_type,
    vac.reason,
    vac.effective_from,
    vac.effective_until,
    u.username AS added_by_username,
    vac.is_active
   FROM ((visitor_access_control vac
     JOIN societies s ON ((vac.society_id = s.id)))
     JOIN users u ON ((vac.added_by = u.id)))
  WHERE (vac.is_active = true)
  ORDER BY s.name, vac.access_type, vac.person_name;
;

-- Removing temporary table and create final VIEW structure
DROP TABLE IF EXISTS "visitor_analytics_summary";
CREATE VIEW "visitor_analytics_summary" AS  SELECT s.name AS society_name,
    (date_trunc('month'::text, vl.check_in_time))::date AS month,
    count(*) AS total_visits,
    count(DISTINCT ((vl.visitor_name)::text || (vl.visitor_phone)::text)) AS unique_visitors,
    count(
        CASE
            WHEN (vl.visitor_type = 'delivery'::visitor_type) THEN 1
            ELSE NULL::integer
        END) AS deliveries,
    count(
        CASE
            WHEN (vl.visitor_type = 'guest'::visitor_type) THEN 1
            ELSE NULL::integer
        END) AS guests,
    count(
        CASE
            WHEN (vl.visitor_type = 'service_provider'::visitor_type) THEN 1
            ELSE NULL::integer
        END) AS service_providers,
    count(
        CASE
            WHEN (vl.status = 'denied'::visitor_status) THEN 1
            ELSE NULL::integer
        END) AS denied_entries,
    avg((EXTRACT(epoch FROM (COALESCE(vl.check_out_time, CURRENT_TIMESTAMP) - vl.check_in_time)) / (60)::numeric)) AS avg_visit_duration_minutes,
    avg(vl.visitor_rating) AS avg_visitor_rating,
    avg(vl.host_rating) AS avg_host_rating
   FROM (visitor_logs vl
     JOIN societies s ON ((vl.society_id = s.id)))
  WHERE (vl.check_in_time >= (CURRENT_DATE - '1 year'::interval))
  GROUP BY s.id, s.name, (date_trunc('month'::text, vl.check_in_time))
  ORDER BY s.name, ((date_trunc('month'::text, vl.check_in_time))::date) DESC;
;

/*!40103 SET TIME_ZONE=IFNULL(@OLD_TIME_ZONE, 'system') */;
/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, '') */;
/*!40014 SET FOREIGN_KEY_CHECKS=IFNULL(@OLD_FOREIGN_KEY_CHECKS, 1) */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40111 SET SQL_NOTES=IFNULL(@OLD_SQL_NOTES, 1) */;
